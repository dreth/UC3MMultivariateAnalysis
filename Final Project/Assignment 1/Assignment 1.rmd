---
title: 'Final project: Step 1'
author: 'Danyu Zhang, Limingrui Wan, Daniel Alonso'
date: 'December 9th, 2020'
output: 'pdf_document'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    collapse = TRUE,
    comment = '#>',
    fig.path = './figures/'
)
```

Importing libraries

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
library(dplyr)
library(ggplot2)
library(reshape2)
library(PerformanceAnalytics)
```

Importing data

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
data <- read.csv('./data/data.csv')
head(data)
```

Excluding smoothed columns as they are redundant transformations of other columns

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
columns_selected <- names(data)[names(data) != 'new_deaths_smoothed' & names(data) != 'new_cases_smoothed' & names(data) != 'new_cases_smoothed_per_million' & names(data) != 'X']
data_n <- data %>% select(all_of(columns_selected))
```

# Exploratory data analysis

## Variable types

### Categorical variables

- continent
- location
- development

### Numerical variables:

#### Discrete

- total_cases
- new_cases
- total_deaths
- new_deaths
- population

#### Continuous

- new_cases_smoothed
- new_deaths_smoothed
- total_cases_per_million
- new_cases_per_million
- new_cases_smoothed_per_million
- total_deaths_per_million
- new_deaths_per_million 
- stringency_index
- population_density
- median_age
- aged_65_older
- aged_70_older
- gdp_per_capita
- extreme_poverty
- cardiovasc_death_rate
- diabetes_prevalence
- hospital_beds_per_thousand
- life_expectancy
- human_development_index

We select variables that we consider interesting to visualize, as the ones we haven't selected might be ralated to these or even ratios of them (in the case of total cases per million)

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
categorical <- c('location','continent','development')
interesting_vars <- c('total_cases','new_cases','total_deaths','stringency_index','population','population_density','median_age','aged_65_older','gdp_per_capita','extreme_poverty','cardiovasc_death_rate','diabetes_prevalence','hospital_beds_per_thousand','life_expectancy','human_development_index')
```

### Plots with categorical variables

#### Countries per continent in the dataset

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
ggplot(data=data) +
    geom_bar(aes(fill=continent, y=continent), show.legend = FALSE)
```

#### Amount of countries per HDI 

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
ggplot(data=data) +
    geom_bar(aes(fill=development, y=development), show.legend = FALSE)
```

\newpage

#### Countries per continent per HDI

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
ggplot(data=data) +
    geom_bar(aes(fill=development ,y=continent))
```

\newpage

#### Proportions of HDI per continent

```{r, echo=TRUE, warning=FALSE, mesage=FALSE}
ggplot(data=data) +
    geom_bar(aes(fill=continent, y=development))
```

### Plots with numerical variables

Defining Colors:
```{r, echo=TRUE, warning=FALSE, message=FALSE}
color_1 <- "khaki"
color_2 <- "lightseagreen"
color_3 <- "lightpink2"
```

#### Boxplots

Grouping variables with a max. value below 87 to show all in a single plot:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
lower_than_87 <- c('aged_65_older','aged_70_older','extreme_poverty','diabetes_prevalence','hospital_beds_per_thousand','median_age','stringency_index','life_expectancy')
lower_than_87 = melt(data, id.vars='X', measure.vars=lower_than_87)
    
lower_than_87 %>%    
    ggplot(aes(x="X", y=value)) +
    geom_boxplot(aes(color=variable))

```

Plotting the rest of the variables:

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=8}
other_vars <- c('human_development_index','cardiovasc_death_rate','gdp_per_capita','population_density','population','new_cases','total_cases','total_deaths')
par(mfrow=c(length(other_vars),1), mar=c(2,1,1,1))
for (i in 1:length(other_vars)) {
    boxplot(data %>% select(other_vars[i]), horizontal=TRUE, main=other_vars[i])
}
```

\newpage

```{r, echo=TRUE, warning=FALSE, message=FALSE}
pa <- data_n %>% dplyr::select(interesting_vars)
chart.Correlation(pa, histogram=TRUE, pch=19, method="pearson")
```