---
title: 'Final project: Step 1'
author: 'Danyu Zhang, Limingrui Wan, Daniel Alonso'
date: 'December 14th, 2020'
output: 
  pdf_document:
    toc: true
    toc_depth: 4
  includes:
    in_header: latex/header.tex
    before_body: latex/before_body.tex
    after_body: latex/after_body.tex
    df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    collapse = TRUE,
    comment = '#>',
    fig.path = './figures/'
)
```

\newpage

Importing libraries

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide'}
library(dplyr)
library(ggplot2)
library(reshape2)
library(PerformanceAnalytics)
library(gridExtra)
library(stringr)
library(foreach)
library(MASS)
library(andrews)
library(mice)
library(factoextra)
library(corrplot)
library(plotrix)
library(corpcor)
```

Importing data

```{r, echo=TRUE, warning=FALSE, message=FALSE}
data <- read.csv('./data/data.csv')
head(data)
```

Excluding smoothed columns as they are redundant transformations of other columns

```{r, echo=TRUE, warning=FALSE, message=FALSE}
removed_cols <- c('new_deaths_smoothed','new_cases_smoothed',
                  'new_cases_smoothed_per_million',
                  'total_cases_per_million','new_deaths_per_million',
                  'new_cases_per_million','total_deaths_per_million',
                  'aged_70_older','new_deaths','X')
data_n <- data
for (col in removed_cols) {data_n <- data_n[names(data_n) != col]}
```

\newpage

# Exploratory data analysis

## Variable types

### Categorical variables

- continent
- location
- development

### Numerical variables

#### Discrete

- total_cases
- new_cases
- total_deaths
- new_deaths
- population

#### Continuous

- new_cases_smoothed
- new_deaths_smoothed
- total_cases_per_million
- new_cases_per_million
- new_cases_smoothed_per_million
- total_deaths_per_million
- new_deaths_per_million 
- stringency_index
- population_density
- median_age
- aged_65_older
- aged_70_older
- gdp_per_capita
- extreme_poverty
- cardiovasc_death_rate
- diabetes_prevalence
- hospital_beds_per_thousand
- life_expectancy
- human_development_index

We select variables that we consider interesting to visualize, as the ones we haven't selected might be ralated to these or even ratios of them (in the case of total cases per million)

```{r, echo=TRUE, warning=FALSE, message=FALSE}
categorical <- c('location','continent','development')
interesting_vars <- c('total_cases','new_cases','total_deaths',
                      'stringency_index','population',
                      'population_density','median_age',
                      'aged_65_older','gdp_per_capita',
                      'extreme_poverty','cardiovasc_death_rate',
                      'diabetes_prevalence','hospital_beds_per_thousand',
                      'life_expectancy','human_development_index')
```

\newpage

## Plots with categorical variables

### Countries per continent in the dataset

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=5.5}
ggplot(data=data) +
    geom_bar(aes(fill=continent, y=continent), show.legend = FALSE)
```

As a heads up, we will have more data points for continents with more countries, as there is an entry per country in the dataset. Therefore Africa will be our continent with the most entries, followed by Asia and Europe.

North america contains all of Central America and the Caribbean. Oceania contains some island countries and archipielagos in the pacific that belong to the continent but it is by far our continent with the least entries.

\newpage

### Amount of countries per HDI 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=5.5}
ggplot(data=data) +
    geom_bar(aes(fill=development, y=development), show.legend = FALSE)
```

For development (which is a variable constructed from the *human_development_index* variable), we have an even amount of countries per HDI, with very high development countries being the largest group.

The *development* variable was constructed as follows from the *human_development_index* variable:

- **very high** for HDI of 0.800 and above
- **high** from 0.700 to 0.799
- **medium** from 0.550 to 0.699
- and **low** below 0.550.

We followed Wikipedia's criteria for the construction of this variable as it accurately represents and summarizes well HDI in 4 categories.

\newpage

### Countries per continent per HDI

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=5.5}
ggplot(data=data) +
    geom_bar(aes(fill=development ,y=continent))
```

We can see here how many countries per continent correspond to which HDI using our constructed development variable. We can see Europe is fully composed of high and very high development countries. North america has most of its countries being high development countries, with a significant group of medium to low development countries, possibly located in Central America and the Caribbean. The very high development countries correspond to Bahamas, Barbados, Canada and the United States.

Africa is mostly composted of medium to low development countries and Asia is a bit of a tossup between high, very high and medium development countries.

To be fair, a country having high HDI does not imply that it isn't a developing country, as most countries with high HDI are, indeed, developing countries. This is simply a categorical representation of Human Development Index. 

\newpage

### Proportions of HDI per continent

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=5.5}
ggplot(data=data) +
    geom_bar(aes(fill=continent, y=development))
```

Looking at the opposite plot to the previous one we can see that most of the very high development countries are located in Europe and Asia. With not a single very high development country in Africa and with most of the low development countries located in Africa.

Medium development countries are mostly located in Asia, Africa and the Americas with not a single medium or low development country located in Europe.

Which again, does not suggest at all that perhaps poverty situations do not exist in the European continent. For instance, about 30% of the population of Albania live under 5.50 USD a day. This figure corresponds to nearly a third of the population and this particular trend shows up for other countries in the Balkan Peninsula along with Moldova and Romania (for more examples). 

\newpage

## Plots with numerical variables

### Function to plot quantitative variables 

\small

```{r , echo=TRUE, warning=FALSE, message=FALSE}
plots <- function(dataset ,col, type, density=TRUE, bins='default', xtick_angles='default') {
    var <- dataset %>% dplyr::select(col)
    if (bins == 'default') {bins = rep(10,3)}
    if (xtick_angles == 'default') {xtick_angles = rep(90,3)}
    if (type == 'boxplot') {
        p1 <- dataset %>% ggplot(aes(x=var[,1])) +
            geom_boxplot() +
            ggtitle(str_interp("${col}")) +
            theme(axis.title.x=element_blank(),axis.text.y=element_blank())
        p2 <- dataset %>% ggplot(aes(x=var[,1], fill=continent)) +
            geom_boxplot() +
            ggtitle(str_interp("${col} grouped by continent")) +
            theme(axis.title.x=element_blank(),axis.text.y=element_blank())
        p3 <- dataset %>% ggplot(aes(x=var[,1], fill=development)) +
            geom_boxplot() +
            ggtitle(str_interp("${col} grouped by development")) +
            theme(axis.title.x=element_blank(),axis.text.y=element_blank())
    } else if (type == 'hist') {
        p1 <- dataset %>% ggplot(aes(x=var[,1])) +
            geom_histogram(aes(y=..density..), bins=bins[1]) +
            geom_density() +
            ggtitle(str_interp("${col}")) +
            theme(axis.title.x=element_blank(),
                  axis.text.x = element_text(angle = xtick_angles[1]))
        if (density == FALSE) {
        p2 <- dataset %>% ggplot(aes(x=var[,1], fill=continent)) +
            geom_histogram(show.legend = FALSE,bins=bins[2]) +
            ggtitle(str_interp("${col} by continent")) +
            theme(axis.title.x=element_blank(),
                  axis.text.x = element_text(angle = xtick_angles[2])) +
            facet_wrap(~continent, nrow = 1)
        p3 <- dataset %>% ggplot(aes(x=var[,1], fill=development)) +
            geom_histogram(show.legend = FALSE,bins=bins[3]) +
            ggtitle(str_interp("${col} by development")) +
            theme(axis.title.x=element_blank(),
                  axis.text.x = element_text(angle = xtick_angles[3])) +
            facet_wrap(~development, nrow = 1)
        } else {
        p2 <- dataset %>% ggplot(aes(x=var[,1], fill=continent)) +
            geom_histogram(show.legend = FALSE,bins=bins[2],aes(y=..density..)) +
            geom_density(show.legend = FALSE) +
            ggtitle(str_interp("${col} by continent")) +
            theme(axis.title.x=element_blank(),
                  axis.text.x = element_text(angle = xtick_angles[2])) +
            facet_wrap(~continent, nrow = 1)
        p3 <- dataset %>% ggplot(aes(x=var[,1], fill=development)) +
            geom_histogram(show.legend = FALSE,bins=bins[3],aes(y=..density..)) +
            geom_density(show.legend = FALSE) +
            ggtitle(str_interp("${col} by development")) +
            theme(axis.title.x=element_blank(),
                  axis.text.x = element_text(angle = xtick_angles[3])) +
            facet_wrap(~development, nrow = 1)
        }} 
    grid.arrange(p1,p2,p3, nrow=3)
}
```

\normalsize

\newpage


### Boxplots for total cases of COVID-19

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='total_cases',type='boxplot')
```

On the first box-plot of the variable, we can observe that the distribution of it is very right skewed, with some outliers. And the box-plots grouped by continents tell us that the country that has the most of the total cases is the US from continent North America which has a very high HDI. Meanwhile, the country that has the most of the total cases of Asia is India (second of the world), and has medium HDI. The third country that has the most of the cases is Brazil from South America with high HDI.

We can probably say that these three countries are the outliers for the variable total cases. 

\newpage 

### Histogram and kernel density for total cases of COVID-19

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='total_cases',type='hist', 
      density=FALSE, bins = c(80,15,15),xtick_angles=c(0,30,20))
```
Observing this graph, we can confirm that the distribution is very right-skewed. 
Only Africa, Europe and Oceania don't have outliers. But it is probably because we don't have the dataset updated yet (we have the data-set updated on 3rd of November, 2020). 
About the development of different countries, we can't group the countries in terms of how they have developed by the total cases of COVID-19 they have. 


\newpage

### Boxplots for new cases of COVID-19 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='new_cases',type='boxplot')
```

In the first box-plot above, we see that the distribution es very right skewed with some outliers. The country that has the most of the new cases is the US. 

Observing the box-plot of new cases grouped by continent it is obvious that the country of North America that has the most of the new cases is the US. And the second country that has the most of the new cases is in Europe, France. Both of them have a very high Human Development Index. The third country that has the most of the new cases is India from Asia with medium HDI.

Another thing to mention is that the countries that have the most of the new cases is very related with the previous variable, which is the total cases, they have similar characteristics.

\newpage

### Histogram and kernel density for new cases of COVID-19

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='new_cases',type='hist', density=FALSE,
      bins = c(70,13,15),xtick_angles=c(0,30,20))
```
Observing this graph, we can confirm that the distribution is very right-skewed with some outliers (especially the US, France and India).

In the histograms of new cases by continent, we can see that Europe has the most dispersed distribution comparing to other continents, which means that the countries of Europe have very different values of new cases from each other. 
About the development of different countries, we can't group the coutries in terms of how they have developed by the new cases per day of COVID-19 they have, the distribution of countries that have a very high Human development Index have a some outliers. 

\newpage

### Boxplots for total deaths due to COVID-19 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='total_deaths',type='boxplot')
```

From the box-plots above we can say that this variable of new deaths is very likely distributed with the variables total cases and new cases. These three variables are all right-skewed and all have some outliers.

In this case, the country that has the most of the total deaths is still the US. 
It is obvious that the country of North America that has the most of the total deaths is the US. And the second country that has the most of the total deaths is in South America, Brazil. The third country that has the most of the total deaths is from Asia, India. 

\newpage

### Histogram and kernel density for total deaths due to COVID-19

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=7}
plots(dataset=data, col='total_deaths',type='hist', density=FALSE,
      bins = c(55,15,13),xtick_angles=c(0,90,90))
```
Again, the distribution is very right-skewed with some outliers (the US, Brazil and India).

In the histograms of new cases by continent and histograms by development, the distributions are also very right-skewed, some of them have outliers. 
We still can't group the coutries in terms of how they have developed by the total deaths of COVID-19 they have, the distribution of countries that have a very high, high and medium Human development Index have a some outliers. 

\newpage

### Boxplots for stringency index (how strict measures are)

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='stringency_index',type='boxplot')
```

From the box-plot above we can say that the global distribution of stringency index is a little left skewed, but it is the most normally distributed until now. There are some countries that have really low stringency index, for example Afghanistan from Asia has stringency index equals to 5.56, or Nicaragua from North America with stringency index 8.33.

Observing the box-plot of stringency index grouped by continent we can see that South America has the most strict measurements and Oceania has the least strict measurements. The rest of them have similar distribution on stringency index. 
Look at the stringency index grouped by development we notice that the countries which have low HDI have less stringency index (using the criterion of quantiles). 

\newpage

### Histogram and kernel density for stringency index

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='stringency_index',type='hist',
      density=TRUE,xtick_angles=c(0,30,20))
```
The distribution is quite symmetric distributed for different continents. Except for Oceania, there are some countries have really low stringency index; and South America, the distribution of this variable is quite left skewed. 
We can probably distinguish the countries with low HDI from others, these countries usually have less stringency index. 

\newpage


### Boxplots for population

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='population',type='boxplot')
```

Observing the box-plot above we can see that the distribution of population is very right skewed, some countries have way more population than others. 
For example, China has the most population of all, India is the second, these two countries are most exaggerated outliersfrom the plot. 

\newpage

### Histogram and kernel density for population

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='population',type='hist', density=FALSE,
      bins = c(60,13,13),xtick_angles=c(0,30,20))
```

The distribution is very right-skewed, the population of each country is very different from others, but the variable population does not provide any information of whether the country has high HDI or not. 

\newpage

### Boxplots for population density

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='population_density',type='boxplot')
```

Population density is a measurement of population per unit area. Observing the previous box-plot above we can see that the distribution of population density is very likely distributed as population distribution, it is very right skewed, some countries have really high population density. 
For instance, Singapore has the most population density of all with a value of 7915.731, it is a small country of Asia with very high HDI. 

\newpage

### Histogram and kernel density for population density

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=7}
plots(dataset=data, col='population_density',type='hist',
      density=FALSE, xtick_angles=c(0,90,20))
```
The distribution is very right-skewed, the population density of each country is very different from others. And the variable does not provide any information of whether the country has high HDI or not. 

\newpage

### Boxplots for median age

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='median_age',type='boxplot')
```

Observing the box-plot for the global median age we can notice that the distribution of it is quite symmetric. The majority of the median age of different countries is located between 20-40. 

But from the grouped box-plots we can find something really interesting: 

- For the box-plots grouped by continent we can see that the median age of Europe is larger (more than 40) than the rest of the continents while Africa has the least median age (less than 20) with some "outliers" that have similar median age as other continents. 

- For the box-plots grouped by development we detect that usually higher developed a country, larger the median age, e.g. the countries that have very high HDI have median of median age more than 40, and the countries that have low HDI have median of median ge less than 20. 
From that, we can conclude that the majority of countries from Africa has low HDI while majority of countries from Europe has very high HDI. 

\newpage

### Histogram and kernel density for median age

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='median_age',type='hist',
      density=TRUE, xtick_angles=c(0,30,20))
```
The distributions of median age for different continent are very different. 
The distribution of Africa is right skewed while others are symmetric. 

The distributions of Asia, North America, Oceania and South America are more flat (platykurtic), and the distributions of Africa and Europe are more concentrated (leptokurtic). 

\newpage

### Boxplots for the percentage of population aged 65 or older

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='aged_65_older',type='boxplot')
```

From the box-plot for the global percentage of population aged 65 or older we can notice that the distribution is right skewed. There are more than half of the countries have less than 10% of population of aged 65 or older. 

However, the grouped box-plots give us more interesting results: 

- In the box-plots grouped by continent we can see that the percentage of population aged 65 or older of Europe is larger (more than 10%) than the rest of the continents while Africa has the least median age (generally less than 10%) with some "outliers" that have similar values as other continents. 

- In the box-plots grouped by development we detect that usually higher developed a country, larger the median age. 
These box-plots kind of give us the same information as the median age of each country, although this variable is not as clear as the previous one, median age. 

\newpage

### Histogram and kernel density for the percentage of population aged 65 or older

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='aged_65_older',type='hist',
      density=TRUE, xtick_angles=c(0,30,20))
```
The distributions of this variable for different continent are very different. 
The distributions of Africa, Asia, North America and South America are right skewed while the distribution of Europe is left skewed.  

The distribution of Africa is more concentrated (leptokurtic) while others are more flat. 
The distributions of countries that have low HDI are more concentrated, and they usually have less percentage of population of aged 65 or older. 

\newpage

### Boxplots for GDP per capita

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='gdp_per_capita',type='boxplot')
```

Observing the box-plot for the global GDP per capita we can see that the distribution is right skewed. The country that has the highest GDP per capita is Qatar from Asia, then comes Luxembourg and Singapore, all of them have a very high HDI.

The grouped box-plots provide more interesting conclusions: 

- In the box-plots grouped by continent we observe that the GDP per capita of Europe is a little bit higher than the rest of the continents while Africa has the least median of GDP per capita with some "outliers" that have similar values as other continents. 

- Nevertheless, the box-plots grouped by development give us more relevant information. We can more or less define whether a new country has very high, high, medium or low HDI by having its GDP per capita. Due to the clear difference of GPD per capita between the different levels of HDI. The countries that have very high HDI often have larger GDP per capita, and the countries with low HDI have less GDP per capita. There is a very clear correlation between these two variables.  

\newpage

### Histogram and kernel density for GDP per capita

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='gdp_per_capita',type='hist',
      density=TRUE, xtick_angles=c(0,30,20))
```
The global distribution of this variable is very right skewed. 
The distributions of Africa is more concentrated (leptokurtic) while others are more flat (platykurtic). 
 
The distributions of countries that have low HDI are more concentrated, and they usually have less GDP per capita. 

\newpage

### Boxplots for percentage of population in extreme proverty

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='extreme_poverty',type='boxplot')
```

From the box-plot of the global extreme poverty we can observe that the distribution is right skewed. The country that has the highest extreme poverty is Madagascar, then comes Democratic Republic of Congo and Burundi, all of them are from Africa. 

However, the grouped box-plots provide more interesting conclusions: 

- The box-plots grouped by continent tell us that the median of the extreme poverty of Europe is the least of all the continents while Africa has the highest median extreme poverty. 

- The box-plots grouped by development give us more important information. The countries that have higher index of extreme poverty often have low HDI while the countries with lower extreme poverty have higher HDI. There is a quite clear correlation between these two variables. 

\newpage

### Histogram and kernel density for percentage of population in extreme proverty

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='extreme_poverty',type='hist',
      density=FALSE, xtick_angles=c(0,30,20))
```
The global distribution of this variable is very right skewed. 
The distributions of Europe is more concentrated (leptokurtic) in low values while others are more flat (platykurtic). 
The distributions of countries that have very high HDI are more concentrated, and they usually have lower extreme poverty.

\newpage

### Boxplots for cardiovascular death rate

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='cardiovasc_death_rate',type='boxplot')
```

It appears that most countries seem to have a cardiovascular death rate between 170.67 and 329.79 deaths per $100,000$ inhabitants. With Uzbekistan being in the absolute extreme, with about 724 deaths by cardiovascular disease per $100,000$ inhabitants.

Grouping by continent we see that Oceania seems to have the largest box (probably due to its lower amount of countries), with a few extreme cases per continent. On average the continent with the highest death rate due to cardiovascular disease is Oceania, followed by Asia. Seems like cardiovascular disease in the Americas could be a less common cause of death than in the rest of the world. 

By development we can see a bit of a pattern, where the least developed a country is, the higher its cardiovascular death rate. However, even if we see this pattern, we can't confidently say that living in a less developed country makes an individual more likely to die from cardiovascular disease. There are definitely many other factors that affect such rate per HDI.

\newpage

### Histogram and kernel density for cardiovascular death rate

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=5.5}
plots(dataset=data, col='cardiovasc_death_rate',type='hist',
      density=TRUE, bins=c(13,10,16), xtick_angles=c(0,0,0))
```

For cardiovascular death rate we see a similar story here than with the general boxplot. The larger concentration of countries clumps around the previously mentioned interval, and the distribution of the variable as is is somewhat normal-like with a relatively long left tail.

Per continent we see that Europe has a significant concentration of countries below 200, along with South America, which, on average, is the continent with the lowest death rate from cardiovascular disease according to our data. For Oceania we see a flat distribution with some high numbers and low numbers, of course, we know that there's less data points, therefore our main concentration below 200 corresponds to New Zealand and Australia, and the rest of the countries seem to have a higher death rate than the rest. Asia's left tail suggests a few other countries with a very high cardiovascular death rate like Uzbekistan.

Looking at development we see the much higher concentration of low cardiovascular death rates for very high development countries. Which in general tend to have better healthcare. However while lower for low and medium development countries, we don't see too much of a difference between the two in terms of their distribution.

\newpage

### Boxplots for diabetes prevalence

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='diabetes_prevalence',type='boxplot')
```

For diabetes prevalence we can see that most countries sit at a value of less than 10, but higher than 5. Some countries surpassing even 30%. These extreme values correspond to a few countries in Oceania and Africa.

The continent with the highest incidence as a proportion of its population seems to be Oceania. Which includes the top 3 countries with the highest amount of diabetics as a percentage of their population. With 30.53% for Marshall Islands. Although the values of the other top 2 countries are not included in our dataset, after some research, we found out that they're also 2 countries in Oceania. North America's diabetes incidence has nearly doubled in the past 20 years, therefore taking the spot 2 as the continent with the highest incidence with Asia, South America, Europe and Africa trailing behind.

We can, to an extent, see that higher development doesn't necessarily mean higher or lower diabetes prevalence and this might relate more to genetic composition and diet of the inhabitants.

\newpage

### Histogram and kernel density for diabetes prevalence

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='diabetes_prevalence',type='hist',
      density=TRUE, bins=c(13,10,16), xtick_angles=c(0,0,0))
```

For the distribution of the data we see that it is resembles a normal distribution with a long left tail and the most countries clumped around the mean of ~7.9%. 

For each continent the incidence seems to be quite different, with some continents having a much higher incidence than others (for example Oceania vs Africa), however they all seem to clump around similar values.

For the development we see the same we saw in the boxplots. Not much of a pattern or indication that there's any specific relationship between HDI and diabetes prevalence.

\newpage

### Boxplots for hospital beds per thousand inhabitants

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='hospital_beds_per_thousand',type='boxplot')
```

Looking at the hospital beds per thousand inhabitants variable boxplots we can see a few interesting things. We could use this variable as a measure of the quality of a healthcare system of a country. Where the higher the bed availability in hospitals is, the better the health system can cope with the demand for beds that a pandemic usually comes with. Especially with how widespread COVID-19 is.

We can see that some extremely underdeveloped countries have about 0.1-0.3 beds per thousand inhabitants, like it is the case with Mali and Niger. Some other countries like South Korea or Belarus have an extremely high capacity, with around 12 and 11 beds per thousand inhabitants respectively. However, even if the amount of beds per thousand inhabitants seems to be low, there's some countries with a suspicious seemingly low amount of beds, however, some of this are clearly just very highly populated countries.  

For countries with high and very high HDI, there's a clear bias towards having greater bed capacity, however, this is not the case for all countries with that quality as there's clearly some countries with medium HDI that have a quite formidable bed capacity as well.

\newpage

### Histogram and kernel density for hospital beds per thousand inhabitants

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='hospital_beds_per_thousand',type='hist',
      density=TRUE, bins=c(13,12,12), xtick_angles=c(0,0,0))
```

These plots tell a little bit of a different story to the boxplots. Where the largest concentration of countries is between 0 and 5 hospital beds per thousand inhabitants with an extremely scarce amount of countries with more than 10 beds per thousand inhabitants.

By segregating the data by continent we see that development does not necesarily mean greater healthcare capacity, with most continents boasting very similar numbers in this aspect whil esome like Asia, Africa, Europe and North america possessing some exceptions with extremely high numbers compred to the rest. However, yes, there's definitely a hint in continents with more developed countries (like Europe or some parts of Asia) which have a higher amount of beds, while Africa, which is predominantly composed of less developed countries tend to have a lower amount of beds.

Finally, looking at development we see that it is rare for much less developed countries to have high bed capacity, while it is much easier for high to very high developed countries to have greater capacity. However, we can't confidently say that there's lots of exceptions to this 'rule'.

\newpage

### Boxplots for life expectancy

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='hospital_beds_per_thousand',type='boxplot')
```

For life expectancy we can see moost countries sitting amove 66 years of age, with values going as low as 53.24 and as high as 84.63. 

Africa has the lowest life expectancy while europe has the highest. The rest of the continents sit at roughly similar ranges.

Grouping by HDI, we can see that the most developed countries have a significantly higher life expectancy than those with low HDI. It clearly shows a strong positive correlation between them. Where the higher the life expectancy the higher the HDI. With very few exceptions.

\newpage

### Histogram and kernel density for life expectancy

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='life_expectancy',type='hist',
      density=TRUE, bins=c(13,12,12), xtick_angles=c(0,0,0))
```

The general plot is somewhat left skewed, as most countries (about 80%) have a life expectancy higher than 65 years of age. Our density plot shows a strong concentration between 70 and 80 years of age, as this range covers the most nations.

For each continent we see that europe shows a typically very high life expectancy while Africa shows a typically lower-than-average life expectancy for most countries with some exceptions. The rest of the continents sit at about the average life expectancy with some countries in Asia and North America at significantly higher-than-average numbers.

For HDI we can again see some of the strong correlation, where life expectancy for very highly developed nations seems to be also quite high and the same happens with less developed nations.

\newpage

### Boxplots for Human Development Index

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='human_development_index',type='boxplot')
```

We can see most countries fall between 0.6 and 0.8, o ur median HDI is 0.741. 

For continents we can see Africa lagging behind with most of its countries between 0.4 and 0.6 HDI, probably given the porverty situation in the continent.

The rest of the continents sit between 0.6 and 0.8 for most of its countries with North America having 2 very extreme outliers which are its minimum and maximum values (corresponding respectively to Haiti and USA). Europe is generally above 0.8.

As our development variable was constructed from the human_development_index variable, we can see that there's clearly marked bounds for each HDI range. The ranges are as follows: *very high* for HDI of 0.800 and above, *high* from 0.700 to 0.799, *medium* from 0.550 to 0.699 and *low* below 0.550.

\newpage

### Histogram and kernel density for Human Development Index

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=6}
plots(dataset=data, col='human_development_index',type='hist',
      density=FALSE, bins=c(13,10,10), xtick_angles=c(0,0,0))
```

For the human development index we can see that the variable is somewhat left skewed, given that the average HDI is ~0.71, which most countries either match or are above of. 

For the HDI per continent we can see that africa has a clear concentration below 0.6, given that most countries in Africa have a low HDI. South america and Asia tell a similar story, most countries are at or above 0.6. We can see that for North America there's a little concentration below 0.6 and most countries betweeen 0.6 and 0.8 as North America includes Central America and the Caribbean which tend to have a lower HDI than USA/Canada, which are towards the right of 0.8. Most european countries have a very high to high HDI, therefore the density plot is quite left skewed and most contries in Oceania have a lower-than-average HDI with the exception of New Zealand and Australia which are above 0.8.

\newpage

## Correlation and scatter plots

We define a function to set colors for categorical variables in a PCP plot:

```{r, echo=TRUE, warning=FALSE}
colors <- function(cat_var, colors_vector) {
    kleuren <- as.numeric(as.factor(cat_var))
    foreach (i=1:length(kleuren), kleur=kleuren) %do% {
        kleuren[i] = colors_vector[kleur]
    }
    return(kleuren)
}
```

Colours we picked:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
# setting colors development
color_1 <- "blueviolet"
color_2 <- "brown"
color_3 <- "seagreen"
color_4 <- "yellow3"
color_5 <- "black"
color_6 <- "deeppink1"
palette1 <- c(color_1,color_2,color_3,color_4)
palette2 <- c(color_1,color_2,color_3,color_4,color_5,color_6)
```

```{r, echo=TRUE, warning=FALSE}
development_colors <- colors(data$development,palette1)
continent_colors <- colors(data$continent,palette2)
```

### Correlation matrix + scatter plot

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=9.5, fig.width=15}
pa <- data_n %>% dplyr::select(interesting_vars)
chart.Correlation(pa, histogram=TRUE, pch=19, method="pearson")
```

Looking at the variables which are interestingly correlated we have the following:

- *Very high correlation*:
    -  **0.94**: Total deaths and total cases, not much to say here, it obviously makes sense that, during a pandemic of a deadly disease, we see correlation between total cases and total deaths. 
    -  **0.91**: median age and proportion of population aged 65 or older are both measures of age within a population, therefore makes sense to see them being highly correlated.
    -  **0.91**: life expectancy and human development index, as life expectancy is a component of HDI it makes sense that these are correlated.
    -  **0.89**: HDI and median age, we can see that clearly, highly developed countries tend to have an aging population, along with lower fertility rates. 
    -  **0.84**: life expectancy and median age. The higher the life expectancy of a population, the more developed the country is, then, the older its population is. This can definitely be framed from a different perspective though.

- *High to medium correlation*:
    -  **0.79**:  total cases and new cases, we can see that the correlation is high, however, not as much as we might expect, which tells us that outbreaks happening in certain countries differ from its total case count significantly, therefore we can have countries with massive total counts but very small daily counts for november 11th 2020.
    -  **0.77**:  new cases and total deaths show a similar trend to what previously described with total cases and new cases. We see that an active outbreak and death count of a country can differ significantly, however, they are usually somewhat correlated.
    -  **-0.77**: extreme poverty and HDI, this is clear, as the more developed a country is, the least likely it is to have a significant portion of its population living under the poverty line.
    -  **0.76**: HDI vs aged_65_older and HDI vs gdp_per_capita, this relates to median age vs HDI as well as to the logical idea that the higher the income of individuals in a population is, the higher the development of the nation they reside in tends to be. 
    -  **-0.75**: extreme poverty and life expectancy are clearly related, as the more developed a nation is, the least people under the poverty line it tends to have, and along with this, the healthier the population will be. People living under the poverty line can very commonly be malnourished or take less care of their health, therefore effectively reducing their life expectancy.
    -  **0.73**: proportion of population aged 65 or older and life expectancy are correlated as well for obvious reasons, similar to median age vs life expectancy.  

- *Other correlations worth mentioning*:
    -  **0.66**: life expectancy and gdp per capita, which at first glance would suggest more correlation than simply 0.66, but this is enough to confidently state that there's definitely a strong relationship between life expectancy and gdp per capita, and definitely, the more a person earns, the longer they tend to live.
    -  **0.66 and 0.65**: hospital beds per thousand inhabitands vs median age and vs aged_65_older. This suggests that the more healthcare availability there is, the generally older the population tends to be. Usually we would mention life expectancy which still boasts a somewhat significant correlation with hospital beds per thousand inhabitants (**0.45**), however, while a higher life expectancy tends to also mean a higher median age, or the other way around, we might want to mention that not necessarily because a country has a high life expectancy, it will have great healthcare availability.
    - **0.54**: population and total cases, one could assume that countries with a very high population would have more trouble managing a pandemic, as they tend to be larger and have more cities and larger cities, therefore making movement within the country a hugely difficult logistic problem. However, countries like China or Indonesia, with their massive populations have been able to manage the pandemic just fine. However, others like India, USA or European countries like Spain, France and Germany, have had a much harder time managing the pandemic.

\newpage

### Scatter plot matrix for interesting variables, grouped by continent

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=12, fig.width=16}
pairs(pa,pch=1,col=continent_colors)
```

Color coding:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
unique(cbind(data$continent, continent_colors))
```

Let's make a few observations from this:

- Usually Europe is at the top of high quality of life metrics like median age, HDI. gdp per capita and such. Europe, however, tends to be at the top (along with some other countries) of the cases and deaths charts. 

- Usually Africa is at the bottom of high quality of life metrics. The rest of the continents are around the middle. However, it also tends to be at the bottom of case and death counts and stringency index. 

- There's clearly defined groups in measures typically used to measure quality of life, things like HDI, life expectancy and similar plots against other variables of the same type, show a clear grouping distinction between continents. 

\newpage

### Scatter plot matrix for interesting variables, grouped by development

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=12, fig.width=16}
pairs(pa,pch=1,col=development_colors)
```

Color coding:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
unique(cbind(data$development, development_colors))
```

Ignoring all correlations using human_development_index as it composes the development variable we can observe a few things:

- Even more so than with continents, quality of life measures are much more clearly defined. We see that countries with the highest development also top the cases correlations with basically everything else. They tend to be at the rightest, and and the top of such plots.

\newpage

### PCP Plot

We group variables by their skewness, while we have many right skewed variables, we group the rest of them in another PCP plot, to have a less crowded plot.

```{r, echo=TRUE, warning=FALSE, message=FALSE}
right_skewed <- c('extreme_poverty','gdp_per_capita',
                  'aged_65_older','population_density',
                  'total_cases','new_cases','population')
right_skewed <- data_n %>% dplyr::select(right_skewed)

others <- c('human_development_index','stringency_index',
            'life_expectancy','median_age','diabetes_prevalence',
            'cardiovasc_death_rate','hospital_beds_per_thousand')
others <- data_n %>% dplyr::select(others)
```

### Right skewed variables PCP

#### Grouped by continent

```{r, echo=TRUE, warning=FALSE, fig.width=14, fig.height=6}
parcoord(right_skewed,var.label=TRUE, col=continent_colors)
```

For the PCP plot of our (mostly) right skewed variables we have the following observations:

- We can see the group differences clearly for the extreme poverty variable, where the top observations are mostly from Africa

- For gdp_per_capita it's clear that the trend is shifted entirely, whereas Africa was at the top of the extreme poverty observations, it is now at the bottom of the gdp_per_capita observations, along with Europe and a few countries from other countinents like Asia, North America and Oceania climbing to the top.

- aged_65_older shows a similar trend as gdp_per_capita which we confirmed in the correlation plot as somewhat correlated variables, along with life expectancy.

- Population density gets mashed down as we have a few extreme outlier countries with incredibly high population densities. The top observation being Singapore, with a staggering population density of 7915.73 people per square kilometer.

- Similar with population density, total cases is opaqued by the extreme total case numbers of USA, India and Brazil.

- Population is topped by China and India, which include represent over 1/4th of the world population.

\newpage

#### Grouped by development

```{r, echo=TRUE, warning=FALSE, fig.width=14, fig.height=9}
parcoord(right_skewed,var.label=TRUE, col=development_colors)
```

When segregating by development:

- Our extreme poverty countries tend to all be countries with low or medium HDI, however, low HDI countries represent the highest spots.

- gdp per capita and aged 65 or older are variables which were previously mentioned as being strongly correlated to HDI, therefore we can see how strong the correlation is here and how starkly it divides groups, where it is almost certain that the top positions of both these variables are taken by very high or high development countries.

- for total cases and new cases it is interesting to see that the seemingly top positions are all covered by the highest development countries. We could attribute this to more widespread testing, but also to much more widespread movements of people. People in low HDI countries tend to move much less and live much simpler lives usually as most inhabitants live in rural areas.

\newpage

### Other variables PCP

#### Grouped by continent

```{r, echo=TRUE, warning=FALSE, fig.width=12, fig.height=8}
parcoord(others,var.label=TRUE, col=continent_colors)
```

When looking at the rest of the variables, which were separated from the right skewed ones to allow for beter visibility of group segregation, we see some interesting things.

Grouping by continent we can point out a few things:

- Human development index is clearly significantly higher for Europe and some countries in North America, Asia and Oceania than the rest of the countries, while African countries usually take the bottom spots with some quite underdeveloped countries in Oceania, Asia and the Americas.

- Stringency index seems like a huge mashup, where the only discernible information we can take is that there's seemingly no way to tell which continents tend to have the strictest rules. Every country seems to do its own thing when it comes to restrictions.

- life expectancy tells much of the same story we saw on the correlation plot and the histograms, clearly, the lower the quality of life in a country, the lower its life expectancy will be. And as most quality of life metrics disfavour the least developed countries, life expectancy is not an exception here. We unfortunately also see Africa taking the lowest positions and very high development countries taking the highest, with Japan taking the top spot closely followed by Some European and Asian countries with very high HDI. Median age also follows this trend.

- For diabetes prevalence there's a bit of a mash, where genetic background and diet seem to probably matter more than the location of individuals. Prevalence seems to be the highest in Oceania and the lowest in Africa and Europe.

- No discernible group difference between continents for cardiovasc_death_rate

- For hospital_beds_per_thousand we can see that there's a tendency for countries in Africa to have significantly lower bed availability, and while more developed countries tend to have higher bed availability, there are definitely plenty of exceptions to this rule.

\newpage

#### Grouped by development

```{r, echo=TRUE, warning=FALSE, fig.width=12, fig.height=9}
parcoord(others,var.label=TRUE, col=development_colors)
```

When grouping by our HDI categories, we see the following:

- Groups are clearly divided in most categories with the exception of diabetes prevalence

- We see much of the same we had mentioned earlier related to stringency index, there's no clear grouping among developed or developing nations. All that's visible is that developed nations might be somewhat less flexible than average with restrictions, but there's plenty of exceptions to this hypothesis.

- For life expectancy and median age, as mentioned previously, there's a clear division among the most and the least developed nations, as development is quite related to these two variables.

- Hospital beds per thousand inhabitants shows much of the same, there's plenty of developed countries with lacking bed availability for new patients. However, there's clearly some of a tendency for highly developed nations to have better availability than nations with a lower HDI.

\newpage

# Mean vector, covariance matrix and correlation matrix estimation

Taking a subset of the dataset for use in this section:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
covid = data[c(categorical,interesting_vars)]
covid$continent=factor(covid$continent)
covid$development=factor(covid$development)
```

## Manipulating the data

### Imputation of missing values

For the NA values we use mice function to impute, when we use method *pmm*, it turned out an error with solving the inverse of data matrix, so we choose method *cart*.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide'}
covid_imp=mice(covid,m=5,method = "cart")
covid_imp=complete(covid_imp)
```

### Creating subsets of the main dataset for the categorical variables

we have two categorical variables *continent* and *development* so we create two groups of subsets. 

```{r, echo=TRUE, warning=FALSE, message=FALSE}
covid = covid_imp
covid_quan=covid[,4:18]

# development
covid_quan_low=covid[covid$development=='low',4:18]
covid_quan_medium=covid[covid$development=='medium',4:18]
covid_quan_high=covid[covid$development=='high',4:18]
covid_quan_veryhigh=covid[covid$development=='very high',4:18]

# continent
covid_asia=covid[covid$continent=='Asia',4:18]
covid_euro=covid[covid$continent=='Europe',4:18]
covid_name=covid[covid$continent=='North America',4:18]
covid_same=covid[covid$continent=='South America',4:18]
covid_afri=covid[covid$continent=='Africa',4:18]
covid_ocea=covid[covid$continent=='Oceania',4:18]
```

\newpage

## Calculations per HDI

### Mean vectors per HDI

we start with the first group by *development* and obtain the mean vectors. and put them together for presenting.

\footnotesize

```{r, echo=TRUE, warning=FALSE, message=FALSE}
mean_a=colMeans(covid_quan)
mean_l=colMeans(covid_quan_low)
mean_m=colMeans(covid_quan_medium)
mean_h=colMeans(covid_quan_high)
mean_vh=colMeans(covid_quan_veryhigh)
cbind(mean_a,mean_l,mean_m,mean_h,mean_vh)
```

\normalsize

We can spot that for some variables there are obvious difference in populations. 

- For median age: the lower the development, the younger the people are
- For prop. of population aged 65 or older: very developed countries have a higher proportion
- For Total cases, New cases, Total deaths, stringency_index, Population, median_age, aged_65_older, gdp_per_capita, hospital_beds_per_thousand, life_expectancy, human_development_index: the higher the HDI, the higher the values for these variables are.
- For prop. of the population living under extreme poverty and cardiovasc_death_rate: the higher the HDI, the lower the values for these variables are.

\newpage

### Covariance matrix per HDI

Then we present the covariance matrix for the data and each subset.

\tiny

General covariance matrix:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov(covid_quan)
```

\normalsize

\newpage

For **low** HDI:

\tiny

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov(covid_quan_low)
```

\normalsize

\newpage

For **medium** HDI:

\tiny

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov(covid_quan_medium)
```

\normalsize

\newpage

For **high** HDI:

\tiny

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov(covid_quan_high)
```

\normalsize

\newpage

For **very high** HDI:

\tiny

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov(covid_quan_veryhigh)
```

\normalsize

\newpage

### Correlation matrix per HDI

Then we calculate the correlation matrix of each one, and visualize them with *corrplot*, and distinguish if there is any difference between groups.

#### No grouping

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=5}
cor_all=cor(covid_quan)
corrplot(cor_all)
```

There exists a high linear relationship between the following variables:

- (>0.7,positive):
    - total_cases-new_cases 
    - total_cases-total_deaths 
    - new_cases-total_deaths 
    - median_age-life_expectancy
    - median_age-aged_65_older
    - median_age-human_development_index 
    - life_expectancy-human_development_index

- (<-0.7,negative):
    - extreme_poverty-life_expectancy
    - extreme_poverty-human_development_index

\newpage

#### Correlation plot for low HDI countries

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=6.5}
cor_low=cor(covid_quan_low)
corrplot(cor_low)
```

There exists a high linear relationship between the following variables for **low** HDI:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths 
    - total_cases-population
    - new_cases-total_deaths
    - median_age-life_expectancy
    - median_age-aged_65_older 

\newpage

#### Correlation plot for medium HDI countries

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=6.5}
cor_m=cor(covid_quan_medium)
corrplot(cor_m)
```

There exists a high linear relationship between the following variables for **medium** HDI:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths
    - total_cases-population
    - new_cases-total_deaths
    - new_cases-population 
    - new_cases-population 
    - median_age-aged_65_older 

\newpage

#### Correlation plot for high HDI countries

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
cor_h=cor(covid_quan_high)
corrplot(cor_h)
```

There exists a high linear relationship between the following variables for **high** HDI:

- (>0.7,positive):
    - new_cases-total_deaths
    - median_age-aged_65_older
 
\newpage

#### Correlation plot for very high HDI countries

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=6}
cor_vh=cor(covid_quan_veryhigh)
corrplot(cor_vh)
```


There exists a high linear relationship between the following variables for **very high** HDI:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths
    - total_cases-population
    - new_cases-total_deaths
    - new_cases-population
    - new_cases-population
    - median_age-aged_65_older
    - life_expectancy-human_development_index

- (<-0.7,negative):
    - cardiovasc_death_rate-life_expectancy
    - diabetes_prevalence-aged_65_older

\newpage

## Calculations per continent

### Mean vectors per continent

\footnotesize

```{r, echo=TRUE, warning=FALSE, message=FALSE}
mean_asia=colMeans(covid_asia)
mean_euro=colMeans(covid_euro)
mean_ocea=colMeans(covid_ocea)
mean_afri=colMeans(covid_afri)
mean_same=colMeans(covid_same)
mean_name=colMeans(covid_name)
cbind(mean_a,mean_asia,mean_afri,mean_ocea,mean_euro,mean_same,mean_name)
```

\normalsize

We can spot clear differences between groups, however, the difference is not as stark and obvious as we had when grouping by HDI. 

\newpage

### Correlation matrix per continent

For continents, since we have 15 variables, given that North America, South America and Oceania have 23, 12, 6 countries respectively, we use the shrinkage covariance matrix instead.

#### Correlation plot for Asia

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=5.5}
cor_as=cor(covid_asia)
corrplot(cor_as)
```

There exists a high linear relationship between the following variables for **Asia**:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths
    - total_cases-population
    - new_cases-total_deaths
    - new_cases-population
    - new_cases-population
    - life_expectacy-human_development_index

\newpage

#### Correlation plot for Africa

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=7}
cor_af=cor(covid_afri)
corrplot(cor_af)
```

There exists a high linear relationship between the following variables for **Africa**:

- (>0.7,positive):
    - new_cases-total_deaths
    - median_age-aged_65_older
    - median_age-gdp_per_capita
    - median_age-life_expectancy
    - median_age-human_development_index

\newpage

#### Correlation plot for Oceania

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
S_oc=cov.shrink(covid_ocea,lambda=0,lambda.var=0,verbose=FALSE)
corrplot(cov2cor(S_oc))
```

As a result of such a small number of observations we tend to have much higher correlations than we should.

\newpage

#### Correlation plot for Europe

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=5.5}
cor_eu=cor(covid_euro)
corrplot(cor_eu)
```

There exists a high linear relationship between the following variables for **Europe**:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths
    - total_cases-population
    - new_cases-total_deaths
    - new_cases-population
    - new_cases-population 
    - median_age-aged_65_older
    - gdp_per_capital-human_development_index
    - life_expectancy-human_development_index

- (<-0.7,negative):
    - cardiovasc_death_rate-life_expectancy
    - cardiovasc_death_rate-human_development_index

\newpage

#### Correlation plot for South America

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=5.5}
S_sa=cov.shrink(covid_same,lambda=0,lambda.var=0,verbose=FALSE)
corrplot(cov2cor(S_sa))
```

There exists a high linear relationship between the following variables for **South America**:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths
    - total_cases-population
    - new_cases-total_deaths
    - new_cases-population
    - new_cases-population
    - median_age-aged_65_older
    - gdp_per_capital-human_development_index
    - life_expectancy-human_development_index

- (<-0.7,negative):
    - cardiovasc_death_rate-life_expectancy
    - cardiovasc_death_rate-human_development_index

\newpage

#### Correlation plot for North America

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=5.5}
S_na=cov.shrink(covid_name,lambda=0,lambda.var=0,verbose=FALSE)
corrplot(cov2cor(S_na))
```

There exists a high linear relationship between the following variables for **North America**:

- (>0.7,positive):
    - total_cases-new_cases
    - total_cases-total_deaths
    - total_cases-population
    - new_cases-total_deaths
    - new_cases-population
    - new_cases-population
    - median_age-aged_65_older
    - gdp_per_capital-human_development_index
    - life_expectancy-human_development_index

- (<-0.7,negative):
    - cardiovasc_death_rate-life_expectancy
    - cardiovasc_death_rate-human_development_index

\newpage

# Principal Component Analysis (PCA)

Taking a subset of the dataset for use in this section:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
covid = data[c(categorical,interesting_vars)]
covid$continent=factor(covid$continent)
covid$development=factor(covid$development)
```

Imputation of missing values:

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide'}
covid_imp=mice(covid,m=5,method = "cart")
covid_imp=complete(covid_imp)
```

```{r, echo=TRUE, warning=FALSE, message=FALSE}
covid = covid_imp
covid_quans=covid[,4:18] # quantitative variables
```


## PCA segregating by development (measure of HDI)

Avoiding adding *human_development_index* as it constructs our target variable *development*.

```{r, echo=TRUE, warning=FALSE, message=FALSE}
covid_quan <- covid_quans[,-15]
```

```{r, echo=TRUE, warning=FALSE, message=FALSE}
n <- nrow(covid_quan)
p <- ncol(covid_quan)
```

\newpage

### Checking the distribution of each variable using histogram

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide', fig.width=10, fig.height=12}
par(mfrow=c(3,5))
sapply(names(covid_quan),function(cname){hist(covid_quan[[cname]],main=cname,col = color_1)})
```

\newpage

Transforming some of the variables using log because some of the variables are highly positively skewed

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide',fig.width=10, fig.height=10}
covid_quan_log=covid_quan
for (i in 1:6) {
    if (i != 4) {
        covid_quan_log[,i]=log(covid_quan[,i])
    }
}
covid_quan_log$new_cases[which(covid_quan_log$new_cases== -Inf )] = 0
par(mfrow=c(3,5))
sapply(names(covid_quan_log),function(cname){hist(covid_quan_log[[cname]],main=cname,col = color_6)})
```

\newpage

PC Scores:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
X_pcs <- prcomp(covid_quan_log, scale=TRUE)
```

### Plotting the first two PCs grouped by development

We can see here the principal components differentiate perfectly the different levels for 4 levels of HDI

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
par(mfrow=c(1,1))
plot(X_pcs$x[,1:2],pch=19,col=development_colors)
```

\newpage

We can check the variance explained by each principal component, e.g. the first pincipal component explains 38% of the total variability and the second one explains 19.4%. 

```{r, echo=TRUE, warning=FALSE, message=FALSE}
fviz_eig(X_pcs,ncp=17,addlabels=T,barfill=color_1,barcolor=color_4)
```

\newpage

### Checking eigenvalues and explained variance

Now we check the eigenvalues and the cumulative percentage of explained variance, and we have decided to take the first 5 principal components. 

We will be using the 33% of the variables and will be keeping the 81.99% of the total information. 

\scriptsize

```{r, echo=TRUE, warning=FALSE, message=FALSE}
get_eigenvalue(X_pcs) 
```

\normalsize

See the loadings of the first five principal components, loadings are the correlations between the original variables and the unit-scaled principal components, so we can examine the importance of each one of the original variables. 

In this case, we see that the variables that are relevant for the first principal component are median_age (weight of -0.38833),  life_expectancy (weight of -0.37843), etc; the variables that are important for the second principal component are population (weight of -0.52215), total_cases of COVID19 (weight of -0.42947), etc. 

\small

```{r, echo=TRUE, warning=FALSE, message=FALSE}
X_pcs$rotation[,1:5]
```

\normalsize

\newpage

### Plot of the first PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,1],pch=19,col=color_1,main="Weights for the first PC", xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,1],labels=colnames(covid_quan_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the second PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,2],pch=19,col=color_1,main="Weights for the second PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,2],labels=colnames(covid_quan_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the third PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,3],pch=19,col=color_1,main="Weights for the third PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,3],labels=colnames(covid_quan_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the fourth PC


```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,4],pch=19,col=color_1,main="Weights for the fourth PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,4],labels=colnames(covid_quan_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the fifth PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,5],pch=19,col=color_1,main="Weights for the fifth PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,5],labels=colnames(covid_quan_log),pos=1,col=color_5,cex=0.75)
```

\newpage

The largest values in magnitude of first principal component are associated with developing countries because of the high values of the variable extreme poverty, and high rate of cardiovascular death rate. 

The largest values in magnitude of second principal component are associated with developed countries because of the high values of the variable GDP per capita, life expectancy and hospital beds per thousand, also, we have seen in the first part (vusualization of variables) that the median age of a country is related to how developed the country is, so the conclusion here fits the previous analysis.

On the other hand, there is something interesting here, it may tell us that the people from highly developed countries may be more prone to develop diabetes. (The radius is arbitrary) 

```{r, echo=TRUE, warning=FALSE, message=FALSE,fig.width=10, fig.height=8}
plot(X_pcs$rotation[,1:2],pch=19,col=color_1,main="Weights for the first two PCs")
abline(h=0,v=0)
text(X_pcs$rotation[,1:2],labels=colnames(covid_quan),pos=1,col=color_5,cex=0.75)
draw.circle(0,0,0.3,border=color_4,lwd=1.5)
```

\newpage

The biplot is an alternative way to plot points and the first two PCs together, this is useful for us because our dataset is not very large. 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
biplot(X_pcs,col=c(color_1,color_5),cex=c(0.4,0.6))
```

\newpage

### Plotting PC scores

Now we plot the scores of the first five principal components, and it shows that the first principal component is the key to show the 4 groups of development. 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=9}
pairs(X_pcs$x[,1:5],col=development_colors,pch=19,main="The first five PCs")
```

The larger the value of the first PC is, then the least developed the country in question might be. Our purpose here is to check the largest values of the first PC.

```{r, echo=TRUE, warning=FALSE, message=FALSE}
sort(X_pcs$x[,1],decreasing=TRUE)[1:10]
```

\newpage

### Plotting the first two PCs grouped by development

Now we plot the correlations between the original data set and the principal components, it is used to understand what are the most important variables in our dataset in terms of variability. 

We can observe from the following plot that the first principal component explains the most the variability, then the second, and so on. 

As we said before, the variables that are important for the first principal component are median age, life expectancy, percentage of aged 65 or older, and with a negative correlation, extreme poverty and cardiovascular death rate with a positive correlation. The higher the first principal component is, the lower the HDI of country will most likely be, and other way around. 

On the contrary, the second principal component is positively correlated to GDP per capita, and negatively correlated to total deaths and total cases of COVID-19. Which probably means that, the higher the value of PC2, the more developed a country is (higher HDI).

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=7}
corrplot(cor(covid_quan,X_pcs$x),is.corr=T)
```

\newpage

## PCA segregating by continent

```{r, echo=TRUE, warning=FALSE, message=FALSE}
n <- nrow(covid_quans)
p <- ncol(covid_quans)
```

### Checking the distribution of each variable using histograms

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide', fig.width=10, fig.height=8}
par(mfrow=c(3,5))
sapply(names(covid_quans),function(cname){hist(covid_quans[[cname]],main=cname,col = color_1)})
```

\newpage

Transforming some of the variables using log because some of the variables are highly positively skewed

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='hide', fig.width=10, fig.height=8}
covid_quans_log=covid_quans
for (i in 1:6) {
    if (i != 4) {
        covid_quans_log[,i]=log(covid_quans[,i])
    }
}
covid_quans_log$new_cases[which(covid_quans_log$new_cases== -Inf )] = 0
par(mfrow=c(3,5))
sapply(names(covid_quans_log),function(cname){hist(covid_quans_log[[cname]],main=cname,col = color_6)})
```

\newpage

PC Scores:

```{r, echo=TRUE, warning=FALSE, message=FALSE}
X_pcs <- prcomp(covid_quans_log, scale=TRUE)
```

### Plotting the first two PCs grouped by continent

We can see here the principal components don't differentiate perfectly all 6 continents, but it classifies very well between Europe (*seagreen*) and Africa (*blueviolet*), just as what we had hypothesised on the first part (we can separate very clearly these two continents by using some important features like GDP or extreme poverty). 

And we cannot comfortably conclude anything about Oceania as we only have 6 observations. 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
plot(X_pcs$x[,1:2],pch=19,col=continent_colors)
```

\newpage

### Checking eigenvalues and explained variance

Now we check the eigenvalues and the cumulative percentage of explained variance, and we have decided to select the first 5 principal components. 

We have used the 33% of the variables and will be keeping the 82.6% of the total information. 

By using the same amount of principal components, we explain a higher percentage of the total variance because of the variable HDI.

\scriptsize

```{r, echo=TRUE, warning=FALSE, message=FALSE}
get_eigenvalue(X_pcs)
```

\normalsize

We can examine the importance of each variable for the different principal components by using the loadings.

In this case, we see that the variable HDI is a very important variable as it is highly correlated with the first principal component (-0.37720), and other variables that are relevant for the first principal component are exactly the same as what we did before. 

And the variables that are important for the second principal component are population (weight of -0.52200), total_cases of COVID19 (weight of -0.45787), etc, which correspond to the first PCA that we have performed.

\footnotesize

```{r, echo=TRUE, warning=FALSE, message=FALSE}
X_pcs$rotation[,1:5]
```

\normalsize

\newpage

### Plot of the first PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,1],pch=19,col=color_1,main="Weights for the first PC", xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,1],labels=colnames(covid_quans_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the second PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,2],pch=19,col=color_1,main="Weights for the second PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,2],labels=colnames(covid_quans_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the third PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,3],pch=19,col=color_1,main="Weights for the third PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,3],labels=colnames(covid_quans_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the fourth PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,4],pch=19,col=color_1,main="Weights for the fourth PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,4],labels=colnames(covid_quans_log),pos=1,col=color_5,cex=0.75)
```

\newpage

### Plot of the fifth PC

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
plot(1:p,X_pcs$rotation[,5],pch=19,col=color_1,main="Weights for the fifth PC",
     xlab="Variables",ylab="Score")
abline(h=0)
text(1:p,X_pcs$rotation[,5],labels=colnames(covid_quans_log),pos=1,col=color_5,cex=0.75)
```

\newpage

The conclusions that we can get from this plot are basically the same as before. 

Largest values in magnitude of first principal component are associated with less developed countries because of the high values of the variable extreme poverty, and high rate of cardiovascular death rate. 

Largest values in magnitude of second principal component are associated with more developed countries because of the high values of the HDI, variable GDP, life expectancy and hospital beds per thousand. (The radius is arbitrary) 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
plot(X_pcs$rotation[,1:2],pch=19,col=color_1,main="Weights for the first two PCs")
abline(h=0,v=0)
text(X_pcs$rotation[,1:2],labels=colnames(covid_quans_log),pos=1,col=color_5,cex=0.6)
library(plotrix)
draw.circle(0,0,0.3,border=color_4,lwd=1.5)
```

\newpage

The biplot is an alternative way to plot points and the first two PCs together.

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=14}
biplot(X_pcs,col=c(color_1,color_5),cex=c(0.4,0.6))
```

\newpage

### Plotting PC scores

Now we plot the scores of the first five principal components, and it shows that the first principal component is the key to show the difference between Europe and Africa. 

And we can only differ Africa from Europe very clearly. 

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=10}
pairs(X_pcs$x[,1:5],col=continent_colors,pch=10,main="The first five PCs")
```

The larger the value of the first PC is, then the least developed the country in question might be. Our purpose here is to check the largest values of the first PC.

```{r, echo=TRUE, warning=FALSE, message=FALSE}
sort(X_pcs$x[,1],decreasing=TRUE)[1:10]
```

\newpage

### Plotting the first two PCs grouped by continent

Now we plot the correlations between the original dataset and the principal components.

The variables that are important for the first principal component are the same with the addition of HDI with a negative correlation. The higher the first principal component is, the higher the probability that the country belongs to Africa and that it isn't in Europe, but we cannot say anything about the other continents, there are not enough differences between them for us to classify. 

On the other hand, the second principal component is also very similar to our first PCA. Which probably means that, the higher the value of PC2, the more likely it becomes that it is located in Europe.

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=12}
corrplot(cor(covid_quans,X_pcs$x),is.corr=T)
```
