---
title: "Step 1"
author: "Limingrui Wan,Daniel Alonso Colado,Danyu Zhang"
date: "2020/12/6"
output: pdf_document
---
1. Perform a visual analysis of the pre-processed data set and obtain interesting conclusions from the analysis. Some of you have already done something similar in the preliminary step, so that this can be included in this step too.
```{r}
data = read.csv("data.csv")
covid = data[c('continent','location','development','total_cases','new_cases','total_deaths','stringency_index','population','population_density','median_age','aged_65_older','gdp_per_capita','extreme_poverty','cardiovasc_death_rate','diabetes_prevalence','hospital_beds_per_thousand','life_expectancy','human_development_index')]
covid$continent=factor(covid$continent)
covid$development=factor(covid$development)
```


2. Estimate the mean vector, covariance matrix and correlation matrix of the quantitative variables of your data set using the appropriate techniques (sample, shrinkage, outliers,...). If there are clearly defined different populations (for example, a categorical variable of interest that distinguishes several groups of observations with different characteristics), perform the analysis for each of the populations and compare the estimates with all the observations. Obtain conclusions from the analysis.
```{r}

covid$extreme_poverty[is.na(covid$extreme_poverty)] = 0
library(mice)
covid_imp=mice(covid,m=5,method = "cart")
covid_imp=complete(covid_imp)
```
We changed the NA values in extreme_poverty into 0s, because in this case NA means that country has no poverty.
For the others NA values we use mice function to imputeï¼Œwhen we use method "pmm", it turned out an error with solving the inverse of data matrix, so we choose method "cart".
```{r}
covid = covid_imp
covid_quan=covid[,4:18]
covid_quan_low=covid[covid$development=='low',4:18]
covid_quan_medium=covid[covid$development=='medium',4:18]
covid_quan_high=covid[covid$development=='high',4:18]
covid_quan_veryhigh=covid[covid$development=='very high',4:18]
mean_a=colMeans(covid_quan)
mean_l=colMeans(covid_quan_low)
mean_m=colMeans(covid_quan_medium)
mean_h=colMeans(covid_quan_high)
mean_vh=colMeans(covid_quan_veryhigh)
cbind(mean_a,mean_l,mean_m,mean_h,mean_vh)
```



```{r}
cov(covid_quan)
```
```{r}
cov(covid_quan_low)
```
```{r}
cov(covid_quan_medium)
```
```{r}
cov(covid_quan_high)
```
```{r}
cov(covid_quan_veryhigh)
```

```{r}
library("corrplot")
cor_all=cor(covid_quan)
corrplot(cor_all)
```

```{r}
cor_low=cor(covid_quan_low)
corrplot(cor_low)
```

```{r}
cor_m=cor(covid_quan_medium)
corrplot(cor_m)
```

```{r}
cor_h=cor(covid_quan_high)
corrplot(cor_h)
```

```{r}
cor_vh=cor(covid_quan_veryhigh)
corrplot(cor_vh)
```

```{r}
covid_asia=covid[covid$continent=='Asia',4:18]
covid_euro=covid[covid$continent=='Europe',4:18]
covid_name=covid[covid$continent=='North America',4:18]
covid_same=covid[covid$continent=='South America',4:18]
covid_afri=covid[covid$continent=='Africa',4:18]
covid_ocea=covid[covid$continent=='Oceania',4:18]
```

```{r}
mean_asia=colMeans(covid_asia)
mean_euro=colMeans(covid_euro)
mean_ocea=colMeans(covid_ocea)
mean_afri=colMeans(covid_afri)
mean_same=colMeans(covid_same)
mean_name=colMeans(covid_name)
cbind(mean_a,mean_asia,mean_afri,mean_ocea,mean_euro,mean_same,mean_name)
```

```{r}
cor_as=cor(covid_asia)
corrplot(cor_as)
```

```{r}
cor_af=cor(covid_afri)
corrplot(cor_af)
```

```{r}
cor_oc=cor(covid_ocea)
corrplot(cor_oc)
```

```{r}
cor_eu=cor(covid_euro)
corrplot(cor_eu)
```

```{r}
cor_sa=cor(covid_same)
corrplot(cor_sa)
```

```{r}
cor_na=cor(covid_name)
corrplot(cor_na)
```
3. Use principal components on the data set and obtain interesting conclusions from the analysis.
```{r}
sapply(names(covid_quan),function(cname){hist(covid_quan[[cname]],main=cname)})
```

```{r}
covid_quan_log=covid_quan
covid_quan_log[,1]=log(covid_quan[,1])
covid_quan_log[,2]=log(covid_quan[,2])
covid_quan_log$new_cases[which(covid_quan_log$new_cases== -Inf )] = 0
covid_quan_log[,3]=log(covid_quan[,3])
covid_quan_log[,5]=log(covid_quan[,5])
covid_quan_log[,6]=log(covid_quan[,6])
sapply(names(covid_quan_log),function(cname){hist(covid_quan_log[[cname]],main=cname)})
```

```{r}
covid_pcs = prcomp(covid_quan_log,scale=TRUE)
head(covid_pcs$x)
plot(covid_pcs$x[,1:2],pch=19,col=c('red','green'))
```
```{r}
library(factoextra)
fviz_eig(covid_pcs,ncp=17,addlabels=T,barfill=color_1,barcolor=color_4)
```
```{r}
get_eigenvalue(covid_pcs)
```
we choose 5 pcs, with an oven 80% variance at all.
and the 5th eigenvalue is 0.968. the dimension of data is reduced from 15 to 5.
```{r}
covid_pcs$rotation[,1:5]
```
```{r}
plot(1:15,covid_pcs$rotation[,1],pch=19,col=color_1,main="Weights for the first PC",
     xlab="Variables",ylab="Score")+abline(h=0)+text(covid_pcs$rotation[,1],labels=colnames(covid_quan),pos=1,col=color_4,cex=0.6)
```

```{r}
plot(1:15,covid_pcs$rotation[,2],pch=19,col=color_1,main="Weights for the second PC",
     xlab="Variables",ylab="Score")+abline(h=0)+text(covid_pcs$rotation[,2],labels=colnames(covid_quan),pos=1,col=color_4,cex=0.6)
```

```{r}
plot(1:15,covid_pcs$rotation[,3],pch=19,col=color_1,main="Weights for the third PC",
     xlab="Variables",ylab="Score")+abline(h=0)+text(covid_pcs$rotation[,3],labels=colnames(covid_quan),pos=1,col=color_4,cex=0.6)
```

```{r}
plot(1:15,covid_pcs$rotation[,4],pch=19,col=color_1,main="Weights for the fourth PC",
     xlab="Variables",ylab="Score")+abline(h=0)+text(covid_pcs$rotation[,4],labels=colnames(covid_quan),pos=1,col=color_4,cex=0.6)
```

```{r}
plot(1:15,covid_pcs$rotation[,5],pch=19,col=color_1,main="Weights for the fifth PC",
     xlab="Variables",ylab="Score")+abline(h=0)+text(covid_pcs$rotation[,5],labels=colnames(covid_quan),pos=1,col=color_4,cex=0.6)
```

```{r}
pairs(covid_pcs$x[,1:5],col=c('red','yellow'),pch=19,main="The first five PCs")
```
```{r}
sort(covid_pcs$x[,1],decreasing=TRUE)[1:10]
```
```{r}
corrplot(cor(covid_quan_log,covid_pcs$x),is.corr=T)
corrplot(cor(covid_quan_log,covid_pcs$x[,1:5]),is.corr=T)
```

