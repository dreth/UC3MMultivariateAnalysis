---
title: 'Topic 2: Exercise 1'
author: "Daniel Alonso"
date: "November 28th, 2020"
output: 'pdf_document'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "./figures/"
)
knitr::knit_engines$set(julia = JuliaCall::eng_juliacall)
```


#### Importing libraries

```{r, echo=TRUE, warning=FALSE, message=FALSE}
library(dplyr)
library(Rcpp)
```

#### Importing data as described by exercise

```{r, echo=TRUE, warning=FALSE, message=FALSE}
d <- read.csv("../../datasets/Colleges.csv")
```

#### Replacing binary variable Private with 1 and 0

```{r, echo=TRUE, warning=FALSE, message=FALSE}
d$Private <- ifelse(d$Private == "Yes", 1, 0)
```

#### Selecting columns

```{r, echo=TRUE, warning=FALSE, message=FALSE}
data <- d %>% dplyr::select('Private','Apps','Accept','Enroll','F.Undergrad')
```

#### Calculating covariances

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov_matrix <- cov(data)
cov_matrix
```

\newpage

#### Calculating correlations

```{r, echo=TRUE, warning=FALSE, message=FALSE}
corr_matrix <- cov2cor(cov_matrix)
corr_matrix
```

#### Experimenting a little bit with the private variable

Let's try changing the Yes to 0 and the No to 1 and checking the covariances and correlations

```{r, echo=TRUE, warning=FALSE, message=FALSE}
d <- read.csv("../../datasets/Colleges.csv")
d$Private <- ifelse(d$Private == "Yes", 0, 1)
data <- d %>% dplyr::select('Private','Apps','Accept','Enroll','F.Undergrad')
```

```{r, echo=TRUE, warning=FALSE, message=FALSE}
cov_matrix <- cov(data)
cov_matrix
corr_matrix <- cov2cor(cov_matrix)
corr_matrix
```

We get the same numbers with reversed signs.

\newpage

Let's play with the amount of 1s and 0s in Private and compare it to a simulated variable with only positive values in order to see how the covariance and correlation change and plot it.

```{Rcpp}
#include <Rcpp.h>
using namespace Rcpp;

// [[Rcpp::export]]
double rcpp_cov(NumericVector v1, NumericVector v2) {
    double vsize = v1.size();
    double cv = 0;
    double v1mean = mean(v1);
    double v2mean = mean(v2);
    double result;
    for (unsigned i=0; i<vsize; i++) {
        cv = cv + (v1[i] - v1mean)*(v2[i] - v2mean);
    }
    result = cv / (vsize - 1);
    return result;
}
```

```{r, echo=TRUE, warning=FALSE, message=FALSE}
simulate <- function(nrows, simulations, qtvarmin, qtvarmax) {
    covs <- matrix(rep(0,nrows*simulations), nrow=nrows, byrow=T)
    corr <- matrix(rep(0,nrows*simulations), nrow=nrows, byrow=T)
    for (s in 1:simulations) {
        pvtapps <- matrix(rep(0,nrows*2),nrow=nrows,byrow=T)
        pvtapps[,2] <- runif(nrows, min=qtvarmin, max=qtvarmax)
        for (i in 1:nrows) {
            pvtapps[,1] <- c(rep(0,nrows-i), rep(1, i))
            covs[i,s] <- rcpp_cov(pvtapps[,1],pvtapps[,2])
            corr[i,s] <- cor(pvtapps[,1],pvtapps[,2])
        }
    }
    covs <- rowMeans(covs)
    corr <- rowMeans(corr)
    plot(covs)
    plot(corr)
}
```

```{julia}
using Random
using Statistics
using Plots

function simulation_binaries(nrows, simulations) 
    covs = zeros(Float64, nrows, simulations)
    corr = zeros(Float64, nrows, simulations)
    for s in 1:simulations
        pvtapps = zeros(Float64, nrows, 2)
        pvtapps[:,2] = rand(1:10,nrows)
        for i in 1:nrows
            pvtapps[:,1] = vcat(zeros(nrows-i,1), ones(i,1))
            covs[i,s] = cov(pvtapps[:,1],pvtapps[:,2])
            corr[i,s] = cor(pvtapps[:,1],pvtapps[:,2])
        end
    end
    covsrowmeans = zeros(Float64, nrows)
    corrrowmeans = zeros(Float64, nrows)
    for i in 1:nrows
        covsrowmeans[i] = mean(covs[i,:])
        corrrowmeans[i] = mean(corr[i,:])
    end
    return covsrowmeans, corrrowmeans
end

(covsrowmeans, corrrowmeans) = simulation_binaries(1000,10)
```

```{r, echo=TRUE, warning=FALSE, message=FALSE}
covsrowmeans <- JuliaCall::julia_eval("covsrowmeans")
plot(covsrowmeans)
corrrowmeans <- JuliaCall::julia_eval("corrrowmeans")
plot(corrrowmeans)
```

## What information does the sample covariance provide?

We know that because the Private variable (binary variable) has only 2 possible values, its covariance with other variables is always going to be relatively small and will not provide much information.

\newpage

## What information does the sample correlation provide?



